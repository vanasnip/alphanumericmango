<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Project X - High Performance Terminal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0a0a0a;
            color: #00ff41;
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: 14px;
            overflow: hidden;
        }
        
        #terminal {
            height: calc(100vh - 60px);
            overflow-y: auto;
            padding: 10px;
            contain: layout style paint;
            will-change: transform;
        }
        
        .line {
            line-height: 1.4;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .line.command { color: #00ff41; }
        .line.output { color: #b3b3b3; }
        .line.error { color: #ff4141; }
        
        #status-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 60px;
            background: #1a1a1a;
            border-top: 1px solid #333;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 20px;
        }
        
        #voice-indicator {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        #voice-indicator.active {
            background: #00ff41;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 65, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 65, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 65, 0); }
        }
        
        #status-text {
            flex: 1;
            font-size: 12px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div id="terminal"></div>
    <div id="status-bar">
        <div id="voice-indicator">ðŸŽ¤</div>
        <div id="status-text">Ready</div>
    </div>
    
    <script>
        // Ultra-lightweight terminal implementation
        class Terminal {
            constructor() {
                this.element = document.getElementById('terminal');
                this.statusText = document.getElementById('status-text');
                this.voiceBtn = document.getElementById('voice-indicator');
                this.lines = [];
                this.maxLines = 1000;
                this.isRecording = false;
                
                this.init();
            }
            
            init() {
                // Voice button handler
                this.voiceBtn.addEventListener('click', () => this.toggleVoice());
                
                // Listen for IPC messages from Electron main process
                if (window.electronAPI) {
                    window.electronAPI.onOutput((output) => this.appendOutput(output));
                    window.electronAPI.onError((error) => this.appendError(error));
                }
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === ' ' && e.ctrlKey) {
                        e.preventDefault();
                        this.toggleVoice();
                    }
                });
                
                this.appendLine('Project X Terminal Ready', 'command');
            }
            
            toggleVoice() {
                this.isRecording = !this.isRecording;
                this.voiceBtn.classList.toggle('active', this.isRecording);
                
                if (this.isRecording) {
                    this.statusText.textContent = 'Listening...';
                    if (window.electronAPI) {
                        window.electronAPI.startVoice();
                    }
                } else {
                    this.statusText.textContent = 'Processing...';
                    if (window.electronAPI) {
                        window.electronAPI.stopVoice();
                    }
                }
            }
            
            appendLine(text, type = 'output') {
                // Create line element
                const line = document.createElement('div');
                line.className = `line ${type}`;
                line.textContent = text;
                
                // Add to DOM
                this.element.appendChild(line);
                
                // Manage memory - remove old lines
                if (this.element.children.length > this.maxLines) {
                    this.element.removeChild(this.element.firstChild);
                }
                
                // Auto-scroll to bottom
                this.element.scrollTop = this.element.scrollHeight;
                
                // Store in memory for search/history
                this.lines.push({ text, type, timestamp: Date.now() });
                if (this.lines.length > this.maxLines) {
                    this.lines.shift();
                }
            }
            
            appendCommand(cmd) {
                this.appendLine(`$ ${cmd}`, 'command');
            }
            
            appendOutput(output) {
                output.split('\n').forEach(line => {
                    if (line.trim()) this.appendLine(line, 'output');
                });
            }
            
            appendError(error) {
                this.appendLine(`Error: ${error}`, 'error');
            }
            
            clear() {
                this.element.innerHTML = '';
                this.lines = [];
                this.appendLine('Terminal cleared', 'command');
            }
        }
        
        // Initialize terminal
        const terminal = new Terminal();
        
        // Expose to Electron for IPC
        window.terminal = terminal;
    </script>
</body>
</html>